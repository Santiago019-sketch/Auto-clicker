-- Simple Auto Clicker with GTK GUI
local lgi = require 'lgi'
local Gtk = lgi.require('Gtk', '3.0')
local GLib = lgi.require('GLib', '2.0')

-- Initialize GTK
Gtk.init()

-- Create window
local window = Gtk.Window {
    title = "Auto Clicker",
    default_width = 200,
    default_height = 150
}

-- Create a vertical box to hold widgets
local box = Gtk.Box {
    orientation = Gtk.Orientation.VERTICAL,
    spacing = 10
}
window:add(box)

-- Create widgets
local startButton = Gtk.Button { label = "Start (F5)" }
local statusLabel = Gtk.Label { label = "Status: Stopped" }
local clicksLabel = Gtk.Label { label = "Clicks: 0" }

-- Add widgets to box
box:pack_start(startButton, true, true, 0)
box:pack_start(statusLabel, true, true, 0)
box:pack_start(clicksLabel, true, true, 0)

-- Variables
local running = false
local clicks = 0

-- Function to simulate mouse click
local function click()
    os.execute("xdotool click 1")  -- For Linux
    -- For Windows, you would use a different command
    clicks = clicks + 1
    clicksLabel.label = "Clicks: " .. clicks
end

-- Timer function for auto clicking
local function autoClick()
    if running then
        click()
        return true -- Continue timer
    end
    return false -- Stop timer
end

-- Button click handler
function startButton:on_clicked()
    running = not running
    if running then
        startButton.label = "Stop (F6)"
        statusLabel.label = "Status: Running"
        GLib.timeout_add(GLib.PRIORITY_DEFAULT, 1, autoClick) -- 1ms delay
    else
        startButton.label = "Start (F5)"
        statusLabel.label = "Status: Stopped"
    end
end

-- Key press handler
window:connect('key-press-event', function(_, event)
    local key = event.keyval
    if key == Gtk.keysyms.F5 then
        running = true
        startButton:clicked()
    elseif key == Gtk.keysyms.F6 then
        running = false
        startButton:clicked()
    elseif key == Gtk.keysyms.Escape then
        Gtk.main_quit()
    end
    return false
end)

-- Quit handler
function window:on_destroy()
    Gtk.main_quit()
end

-- Show window and start main loop
window:show_all()
Gtk.main()
